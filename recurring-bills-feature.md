# Recurring Bills Feature Plan

This document outlines the plan for implementing a recurring bills feature. This is a critical part of the application experience, allowing users to manage predictable monthly expenses efficiently.

## Objective

To create a system for managing recurring monthly expenses, which are automatically included in each month's calculations. This will reduce manual data entry and ensure consistency.

## Core Feature Breakdown

### 1. Database Schema

A new table, `recurring_expenses`, will be created in the database with the following fields:

-   `id`: Primary Key
-   `description`: Text, not null
-   `default_amount`: Numeric, not null
-   `category_id`: Integer, Foreign Key to `categories`
-   `paid_by_user_id`: Integer, Foreign Key to `users`
-   `split_type`: Text (e.g., '50/50', 'custom')
-   `split_ratio_user1`: Integer
-   `split_ratio_user2`: Integer
-   `is_active`: Boolean, defaults to `true` (to allow for deactivating without deleting)
-   `created_at`: Timestamp

### 2. Backend (API)

-   **New Endpoints**: A new set of CRUD endpoints will be created under `/api/recurring-expenses`:
    -   `GET /`: List all active recurring expenses.
    -   `POST /`: Create a new recurring expense.
    -   `PUT /:id`: Update a recurring expense.
    -   `DELETE /:id`: Deactivate a recurring expense (`is_active = false`).
-   **Monthly Generation Logic**: The monthly settlement logic will be updated. When a settlement is calculated for a month for the first time, the system will check for any active recurring bills and create corresponding entries in the main `expenses` table for that month. This makes them editable for that specific month without altering the template.

### 3. Frontend (UI)

-   **New Management Page**: A new page, "Recurring Bills," will be added to the application, accessible from the main navigation.
-   **UI Components**:
    -   A list displaying all current recurring bills, with options to edit or deactivate them.
    -   A form for adding a new recurring bill. This form will be nearly identical to the standard expense form but will not have a date field.
-   **Integration with Settlement**: The bill-splitting calculator will not need significant changes, as it will simply consume the expenses generated by this new recurring bills system.

## User Flow

1.  A user navigates to the "Recurring Bills" page.
2.  They add a new recurring bill, for example, "Daycare" for 800 SEK, paid by User A, split 50/50.
3.  On the first of the next month, this "Daycare" expense is automatically added to the main expense list.
4.  If the daycare cost for that month happens to be 850 SEK, the user can simply edit that specific expense entry without changing the 800 SEK default for future months.
5.  The monthly settlement calculation will include the 850 SEK expense as expected.

This plan integrates the concept of recurring bills smoothly into the existing application structure. It provides both automation and flexibility.